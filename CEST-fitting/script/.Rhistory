PACKAGES <- readRDS("C:/Users/berna/Downloads/PACKAGES.rds")
View(PACKAGES)
View(PACKAGES)
PACKAGES
clear
clc
clear
file <- file.choose()
readRDS()
readRDS(file = file)
remove.packages("rstan")
if (file.exists(".RData")) file.remove(".RData")
install.packages("rstan", repos = "https://cloud.r-project.org/", dependencies = TRUE)
install.packages("bayesplot")
install.packages("cmdstanr", repos = c("https://mc-stan.org/r-packages/", getOption("repos")))
install_cmdstan()
library(cmdstanr)
check_cmdstan_toolchain(fix = TRUE, quiet = TRUE)
check_cmdstan_toolchain()
install_cmdstan(cores = 4)
library(cmdstanr)
check_cmdstan_toolchain(fix = TRUE, quiet = TRUE)
check_cmdstan_toolchain()
install_cmdstan(cores = 4)
install_cmdstan(cores = 4, overwrite = TRUE)
cmdstan_path()
cmdstan_version()
file <- file.path(cmdstan_path(), "examples","bernoulli","bernoulli.stan")
mod <- cmdstan_model(file)
mod$print
mod$exe_file()
mod$print()
# names correspond to the data block in the Stan program
data_list <- list(N = 10, y = c(0,1,0,0,0,0,0,0,0,1))
fit <- mod$sample(
data = data_list,
seed = 123,
chains = 4,
parallel_chains = 4,
refresh = 500 # print update every 500 iters
)
$sample
fit$summary()
mcmc_hist(fit$draw("theta"))
library(posterior)
library(bayesplot)
color_scheme_set("brightblue")
mcmc_hist(fit$draw("theta"))
# default is a 3-D draws_array object from the posterior package
# iterations x chains x variables
draws_arr <- fit$draws() # or format="array"
str(draws_arr)
# draws x variables data frame
draws_df <- fit$draws(format = "df")
str(draws_df)
# this should be identical to draws_df created via draws(format = "df")
draws_df_2 <- as_draws_df(draws_arr)
identical(draws_df, draws_df_2)
mcmc_hist(fit$draws("theta"))
A = [2,2;3,4]
install.packages("StanHeaders", repos = c("https://mc-stan.org/r-packages/", getOption("repos")))
install.packages("rstan", repos = c("https://mc-stan.org/r-packages/", getOption("repos")))
install.packages("StanHeaders", repos = c("https://mc-stan.org/r-packages/", getOption("repos")))
install.packages("StanHeaders", repos = c("https://mc-stan.org/r-packages/", getOption("repos")))
install.packages("rstan", repos = c("https://mc-stan.org/r-packages/", getOption("repos")))
install.packages(bayesplot)
installed.packages(bayesplot)
installed.packages(rstan)
library(rstan)
detach("package:rstan", unload = TRUE)
library(bayesplot)
install.packages("bayesplot")
install.packages("bayesplot")
installed.packages("rstan")
installed.packages("bayesplot")
require(rstan)
require(bayesplot)
require(parallel)
require(rstan)
require(parallel)
require(bayesplot)
require(dplyr)
require(tidyr)
require(fdrtool)
require(ggplot2)
source(file.path(toolsDir, "stanTools.R"))
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
## Read data
Xdata <- read.csv(file.path(dataDir, "LP30_323.csv"),header = FALSE)
modelName <- "CEST_rk45"
setwd("~/Weizmann/rotation-1/CEST-fitting/script")
scriptDir <- getwd()
projectDir <- dirname(scriptDir)
figDir <- file.path(projectDir, "deliv", "figure", modelName)
tabDir <- file.path(projectDir, "deliv", "table", modelName)
dataDir <- file.path(projectDir, "data", "derived")
modelDir <- file.path(projectDir, "model")
outDir <- file.path(modelDir, modelName)
toolsDir <- file.path(scriptDir, "tools")
require(rstan)
require(parallel)
require(bayesplot)
require(dplyr)
require(tidyr)
require(fdrtool)
require(ggplot2)
source(file.path(toolsDir, "stanTools.R"))
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
## Read data
Xdata <- read.csv(file.path(dataDir, "LP30_323.csv"),header = FALSE)
xZ = with(Xdata,V1)
Z = with(Xdata,V2)
## Create data set
data <- list(
N = nrow(Xdata),
R1a = 8,
R2a = 393,
w1 = 500.0,
dw = -260.0,
tp = 0.2,
xZ = xZ,
Z = Z
)
## Specify initial estimates
init = function() list(
R1b = rnorm(1,50,15),
R2b = rnorm(1,27000,2000),
f = rnorm(1,0.02,0.01),
k = rnorm(1,285,10),
sigma = rnorm(0,0.1)
)
## Specify the variables for which you want history and density plots
parametersToPlot <- c("R1b", "R2b", "f", "k","sigma")
## Additional variables to monitor
otherRVs <- c("Z_pred")
parameters <- c(parametersToPlot, otherRVs)
nChains <- 4
nPost <- 1000 ## Number of post-burn-in samples samples per chain after thinning
nBurn <- 1000 ## Number of burn-in samples per chain after thinning
nThin <- 1
nIter <- (nPost + nBurn) * nThin
nBurnin <- nBurn * nThin
dir.create(outDir)
fit <- stan(file = file.path(modelDir, paste(modelName, ".stan", sep = "")),
data = data,
pars = parameters,
iter = nIter,
warmup = nBurnin,
thin = nThin,
#control = list(adapt_delta = 0.9),
chains = nChains)
fit <- stan(file = file.path(modelDir, paste(modelName, ".stan", sep = "")),
data = data,
pars = parameters,
iter = nIter,
warmup = nBurnin,
thin = nThin,
#control = list(adapt_delta = 0.9),
chains = nChains)
fit <- stan(file = file.path(modelDir, paste(modelName, ".stan", sep = "")),
data = data,
pars = parameters,
iter = nIter,
warmup = nBurnin,
thin = nThin,
#control = list(adapt_delta = 0.9),
chains = nChains)
fit <- stan(file = file.path(modelDir, paste(modelName, ".stan", sep = "")),
data = data,
pars = parameters,
iter = nIter,
warmup = nBurnin,
thin = nThin,
#control = list(adapt_delta = 0.9),
chains = nChains)
fit <- stan(file = file.path(modelDir, paste(modelName, ".stan", sep = "")),
data = data,
pars = parameters,
iter = nIter,
warmup = nBurnin,
thin = nThin,
#control = list(adapt_delta = 0.9),
chains = nChains)
fit <- stan(file = file.path(modelDir, paste(modelName, ".stan", sep = "")),
data = data,
pars = parameters,
iter = nIter,
warmup = nBurnin,
thin = nThin,
#control = list(adapt_delta = 0.9),
chains = nChains)
fit <- stan(file = file.path(modelDir, paste(modelName, ".stan", sep = "")),
data = data,
pars = parameters,
iter = nIter,
warmup = nBurnin,
thin = nThin,
#control = list(adapt_delta = 0.9),
chains = nChains)
fit <- stan(file = file.path(modelDir, paste(modelName, ".stan", sep = "")),
data = data,
pars = parameters,
iter = nIter,
warmup = nBurnin,
thin = nThin,
#control = list(adapt_delta = 0.9),
chains = nChains)
## Create data set
data <- list(
N = nrow(Xdata),
R1a = 8,
R2a = 393,
w1 = 500.0,
dw = -260.0,
tp = c(0.2),
xZ = xZ,
Z = Z
)
rm(list = ls())
gc()
modelName <- "CEST_rk45"
setwd("~/Weizmann/rotation-1/CEST-fitting/script")
scriptDir <- getwd()
projectDir <- dirname(scriptDir)
figDir <- file.path(projectDir, "deliv", "figure", modelName)
tabDir <- file.path(projectDir, "deliv", "table", modelName)
dataDir <- file.path(projectDir, "data", "derived")
modelDir <- file.path(projectDir, "model")
outDir <- file.path(modelDir, modelName)
toolsDir <- file.path(scriptDir, "tools")
require(rstan)
require(parallel)
require(bayesplot)
require(dplyr)
require(tidyr)
require(fdrtool)
require(ggplot2)
source(file.path(toolsDir, "stanTools.R"))
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
## Read data
Xdata <- read.csv(file.path(dataDir, "LP30_323.csv"),header = FALSE)
xZ = with(Xdata,V1)
Z = with(Xdata,V2)
## Create data set
data <- list(
N = nrow(Xdata),
R1a = 8,
R2a = 393,
w1 = 500.0,
dw = -260.0,
tp = c(0.2),
xZ = xZ,
Z = Z
)
## Specify initial estimates
init = function() list(
R1b = rnorm(1,50,15),
R2b = rnorm(1,27000,2000),
f = rnorm(1,0.02,0.01),
k = rnorm(1,285,10),
sigma = rnorm(0,0.1)
)
## Specify the variables for which you want history and density plots
parametersToPlot <- c("R1b", "R2b", "f", "k","sigma")
## Additional variables to monitor
otherRVs <- c("Z_pred")
parameters <- c(parametersToPlot, otherRVs)
##################################################################
# Run Stan
nChains <- 4
nPost <- 1000 ## Number of post-burn-in samples samples per chain after thinning
nBurn <- 1000 ## Number of burn-in samples per chain after thinning
nThin <- 1
nIter <- (nPost + nBurn) * nThin
nBurnin <- nBurn * nThin
dir.create(outDir)
fit <- stan(file = file.path(modelDir, paste(modelName, ".stan", sep = "")),
data = data,
pars = parameters,
iter = nIter,
warmup = nBurnin,
thin = nThin,
#control = list(adapt_delta = 0.9),
chains = nChains)
save(fit, file = file.path(outDir, paste(modelName, "Fit.Rsave", sep = "")))
